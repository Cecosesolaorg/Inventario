<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INVENTARIO DE VIVERES PASILLO 3 PANES</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- CONFIGURACI√ìN DE VARIABLES Y TEMA --- */
        :root {
            --neon-cyan: #22d3ee;
            --neon-lime: #a3e635;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d;
            color: #e5e7eb;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Utilidades */
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .neon-title { text-shadow: 0 0 5px rgba(34, 211, 238, 0.8); }
        
        .calc-btn { 
            @apply p-4 text-2xl font-bold rounded-xl shadow-md transition duration-150 transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none; 
        }

        /* --- ESTILOS DE TABLA (Simulaci√≥n Excel) --- */
        #inventory-table {
            border-collapse: separate; 
            border-spacing: 0;
            width: 100%;
            border: 1px solid #374151;
            border-radius: 0.75rem; /* rounded-xl */
            overflow: hidden;
        }
        
        .table-header, .table-data {
            padding: 12px 16px;
            border-bottom: 1px solid #374151;
        }

        .table-header {
            background-color: #1f2937;
            color: #22d3ee;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
        }

        .table-row { transition: background-color 0.2s; }
        .table-row:last-child .table-data { border-bottom: none; }
        
        /* Modo Oscuro (Default) */
        .table-row:hover { background-color: #1f2937; }
        
        .product-cell {
            font-size: 0.95rem;
            color: #e5e7eb;
            border-right: 1px solid #374151;
        }

        .qty-cell {
            text-align: center;
            font-weight: bold;
            color: #a3e635;
            background-color: rgba(17, 24, 39, 0.5);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .qty-cell:hover {
            background-color: #374151;
            text-decoration: underline;
        }

        /* --- TEMA CLARO --- */
        .light-theme body { background-color: #f3f4f6; color: #1f2937; }
        .light-theme .main-container { background-color: #ffffff; border-color: #cbd5e1; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .light-theme .neon-title { color: #2563eb; text-shadow: none; }
        .light-theme .accent-text { color: #2563eb; }
        
        /* Tabla Claro */
        .light-theme #inventory-table { border-color: #e5e7eb; }
        .light-theme .table-header { background-color: #bfdbfe; color: #1e40af; border-bottom: 1px solid #93c5fd; }
        .light-theme .table-data { border-bottom: 1px solid #e5e7eb; }
        .light-theme .product-cell { color: #1f2937; border-right: 1px solid #e5e7eb; }
        .light-theme .table-row:hover { background-color: #f0f9ff; }
        .light-theme .qty-cell { background-color: #ecfdf5; color: #059669; }
        .light-theme .qty-cell:hover { background-color: #d1fae5; }

        /* Inputs y Footer Claro */
        .light-theme input[type="text"] { background-color: #ffffff; border-color: #94a3b8; color: #0f172a; }
        .light-theme .footer-container { background-color: #e2e8f0; border-color: #94a3b8; }
    </style>
</head>
<body class="p-2 md:p-6 min-h-screen">

    <div class="max-w-4xl mx-auto bg-gray-900 p-4 md:p-8 rounded-2xl shadow-2xl border border-cyan-900 main-container">
        <header class="mb-4">
            <!-- Cabecera tipo Reporte -->
            <div class="border border-gray-700 p-4 rounded-xl mb-6 bg-gray-800/50 light-theme:bg-white light-theme:border-blue-200 transition-colors">
                <!-- Fila 1: ORGANISMO Y FECHA -->
                <div class="flex flex-col md:flex-row justify-between md:items-center border-b border-gray-700 pb-2 mb-2 light-theme:border-gray-200">
                    <p class="text-xs font-bold text-cyan-400 light-theme:text-blue-600 tracking-wide mb-1 md:mb-0">ORGANISMO DE INTEGRACI√ìN COOPERATIVA CECOSESOLA, R.L. J085030140</p>
                    <p class="text-xs text-gray-400 light-theme:text-gray-500">FECHA: <span id="report-date" class="font-semibold text-gray-200 light-theme:text-gray-800"></span></p>
                </div>
                
                <!-- Fila 2: PASILLO Y RESPONSABLES -->
                <div class="flex flex-col md:flex-row justify-between items-start">
                    <div class="mb-2 md:mb-0">
                        <h2 class="text-2xl md:text-3xl font-extrabold text-cyan-400 neon-title light-theme:text-blue-700 uppercase">üçû PASILLO PANES üçû</h2>
                        <h3 class="text-lg font-bold text-gray-300 light-theme:text-gray-600">FERIA DEL ESTE</h3>
                    </div>
                    
                    <div class="text-sm w-full md:w-auto bg-gray-900/50 p-2 rounded light-theme:bg-gray-100">
                        <p class="text-gray-400 light-theme:text-gray-500 mb-1">RESPONSABLE 1: <span id="resp1-display" class="font-semibold text-white light-theme:text-gray-800 uppercase">Sin Nombre</span></p>
                        <p class="text-gray-400 light-theme:text-gray-500">RESPONSABLE 2: <span id="resp2-display" class="font-semibold text-white light-theme:text-gray-800 uppercase">Sin Nombre</span></p>
                    </div>
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="flex justify-end space-x-3 items-center sticky top-2 z-10 bg-gray-900/90 p-2 rounded-xl backdrop-blur-sm light-theme:bg-white/90">
                <button 
                    id="toggle-theme-btn"
                    onclick="toggleTheme()"
                    class="p-2 rounded-full text-cyan-400 hover:bg-gray-700 transition duration-200 border border-transparent hover:border-gray-600"
                    aria-label="Cambiar tema"
                >
                    <!-- Luna -->
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 12.001 12.001 0 0012 21a12.001 12.001 0 008.354-5.646z" />
                    </svg>
                    <!-- Sol -->
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </button>

                <!-- Bot√≥n Reset (Borrar Todo) -->
                <button 
                    onclick="resetAllData()"
                    class="bg-red-600/80 hover:bg-red-500 text-white p-2 rounded-xl shadow-lg transition duration-200"
                    title="Borrar todos los datos y empezar de nuevo"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
                
                <button 
                    onclick="downloadExcel()"
                    class="bg-lime-500 hover:bg-lime-400 text-gray-900 font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200 flex items-center transform hover:scale-105 active:scale-95 text-sm md:text-base"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L10 11.586l2.293-2.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Descargar CSV
                </button>
            </div>
        </header>

        <!-- Tabla de Inventario -->
        <div class="mt-4">
            <table id="inventory-table">
                <thead>
                    <tr>
                        <th class="table-header text-left w-[75%] md:w-[80%] pl-4">PRODUCTO</th>
                        <th class="table-header w-[25%] md:w-[20%]">CANTIDAD</th>
                    </tr>
                </thead>
                <tbody id="inventory-list">
                    <!-- Filas generadas por JS -->
                </tbody>
            </table>
        </div>

        <!-- Footer / Resumen -->
        <footer class="mt-8 pt-6 border-t-4 border-cyan-600 bg-gray-800 rounded-lg p-4 shadow-xl footer-container transition-colors">
            <div class="flex flex-col sm:flex-row items-start sm:items-stretch justify-between gap-6">
                
                <!-- Contador -->
                <div class="w-full sm:w-1/2 flex flex-col"> 
                    <p class="text-lg font-bold text-cyan-400 mb-2 accent-text uppercase">Items con Existencia:</p>
                    <div class="flex-grow bg-cyan-600/20 border border-cyan-600/50 rounded-xl p-4 flex items-center justify-center">
                        <span id="stocked-products-count" class="text-5xl font-extrabold text-cyan-400 light-theme:text-blue-600">0</span>
                    </div>
                </div>
                
                <!-- Inputs Responsables -->
                <div class="w-full sm:w-1/2 flex flex-col space-y-3 sm:pl-4 sm:border-l border-gray-600 light-theme:border-gray-300">
                    <div>
                        <label class="text-sm font-semibold text-gray-400 light-theme:text-gray-600 uppercase block mb-1">Responsable 1</label>
                        <input type="text" id="responsable-1" placeholder="Nombre y Apellido" class="w-full p-2 rounded border border-gray-600 bg-gray-900 text-white focus:ring-2 focus:ring-cyan-500 outline-none transition-colors" oninput="updateReportHeaders()">
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-400 light-theme:text-gray-600 uppercase block mb-1">Responsable 2</label>
                        <input type="text" id="responsable-2" placeholder="Nombre y Apellido" class="w-full p-2 rounded border border-gray-600 bg-gray-900 text-white focus:ring-2 focus:ring-cyan-500 outline-none transition-colors" oninput="updateReportHeaders()">
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal Calculadora -->
    <div id="calculator-modal" class="modal-overlay" onclick="if(event.target === this) closeCalculator()">
        <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-xs mx-4 transform transition-all border border-cyan-700 relative">
            <!-- Header Calc -->
            <div class="mb-4 text-center">
                <h2 class="text-lg font-bold text-cyan-400 leading-tight truncate px-2" id="calc-product-name">Producto</h2>
            </div>

            <!-- Pantalla -->
            <div class="bg-gray-900 p-3 mb-4 rounded-lg text-right border border-gray-700 shadow-inner">
                <div class="text-gray-500 text-xs h-4 mb-1 truncate" id="calc-history"></div>
                <div id="calc-display" class="text-white text-4xl font-mono font-bold truncate tracking-widest">0</div>
            </div>

            <!-- Teclado -->
            <div class="grid grid-cols-4 gap-2 mb-4">
                <button onclick="clearCalculator()" class="col-span-1 bg-red-900/80 text-red-200 rounded-lg p-3 font-bold hover:bg-red-800">C</button>
                <button onclick="backspaceCalculator()" class="col-span-1 bg-red-900/80 text-red-200 rounded-lg p-3 font-bold hover:bg-red-800">‚å´</button>
                <button onclick="handleOperator('/')" class="bg-gray-700 text-cyan-400 rounded-lg p-3 font-bold hover:bg-gray-600">√∑</button>
                <button onclick="handleOperator('*')" class="bg-gray-700 text-cyan-400 rounded-lg p-3 font-bold hover:bg-gray-600">√ó</button>

                <button onclick="inputDigit('7')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">7</button>
                <button onclick="inputDigit('8')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">8</button>
                <button onclick="inputDigit('9')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">9</button>
                <button onclick="handleOperator('-')" class="bg-gray-700 text-cyan-400 rounded-lg p-3 font-bold hover:bg-gray-600">-</button>

                <button onclick="inputDigit('4')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">4</button>
                <button onclick="inputDigit('5')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">5</button>
                <button onclick="inputDigit('6')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">6</button>
                <button onclick="handleOperator('+')" class="bg-gray-700 text-cyan-400 rounded-lg p-3 font-bold hover:bg-gray-600">+</button>

                <button onclick="inputDigit('1')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">1</button>
                <button onclick="inputDigit('2')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">2</button>
                <button onclick="inputDigit('3')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">3</button>
                <button onclick="handleOperator('=')" class="row-span-2 bg-cyan-600 text-white rounded-lg p-3 font-bold hover:bg-cyan-500 shadow-lg flex items-center justify-center text-xl">=</button>

                <button onclick="inputDigit('0')" class="col-span-2 bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">0</button>
                <button onclick="inputDigit('.')" class="bg-gray-600 text-white rounded-lg p-3 font-bold hover:bg-gray-500">.</button>
            </div>

            <!-- Botones Control -->
            <div class="flex space-x-2">
                <button onclick="closeCalculator()" class="flex-1 py-3 bg-gray-700 text-gray-300 rounded-xl font-semibold hover:bg-gray-600">Cancelar</button>
                <button onclick="saveAndClose()" class="flex-1 py-3 bg-lime-600 text-white rounded-xl font-bold hover:bg-lime-500 shadow-lg shadow-lime-900/20">GUARDAR</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATOS ---
        const productNames = [
            "CACHITOS ", "CATALINAS /NEGRAS* 10", "COCADAS", "GALLETA ARTESANAL ", 
            "PAN ARABE", "PAN CORTADITOS", "PAN DE GUAYABA", "PAN DE HAMBURGUESA X 08", 
            "PAN DE SANDWICHE  GRD", "PAN DE SANDWICHE  INTEGRAL ", "PAN DE SANDWICHE  PQ", "PAN DE SANDWIS NACIONAL 500GR", 
            "PAN DE TUNJA PEQ", "PANELA DULCE", "SOPA SOBRE MAGGY", 
        ];

        // CONFIGURACI√ìN DE CLAVES DE ALMACENAMIENTO
        const STORAGE_KEY_DATA = 'inventoryData_Panes';
        const STORAGE_KEY_RESP1 = 'resp1_Panes';
        const STORAGE_KEY_RESP2 = 'resp2_Panes';

        // CARGAR DATOS GUARDADOS
        let savedData = localStorage.getItem(STORAGE_KEY_DATA);
        let inventoryData = savedData ? JSON.parse(savedData) : productNames.map(name => ({
            name: name,
            quantity: 0,
            history: "0"
        }));

        // --- INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            // Restaurar Responsables
            const savedResp1 = localStorage.getItem(STORAGE_KEY_RESP1);
            const savedResp2 = localStorage.getItem(STORAGE_KEY_RESP2);
            
            if(savedResp1) document.getElementById('responsable-1').value = savedResp1;
            if(savedResp2) document.getElementById('responsable-2').value = savedResp2;

            renderInventoryTable();
            updateReportHeaders(); 
            calculateTotalItems(); 
            
            document.getElementById('report-date').textContent = new Date().toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
        });

        // Funci√≥n para guardar todo en LocalStorage
        function saveDataToLocal() {
            localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(inventoryData));
            localStorage.setItem(STORAGE_KEY_RESP1, document.getElementById('responsable-1').value);
            localStorage.setItem(STORAGE_KEY_RESP2, document.getElementById('responsable-2').value);
            // Guardado silencioso
        }

        function resetAllData() {
            if(confirm("‚ö†Ô∏è ¬øEst√°s seguro de que quieres BORRAR TODOS LOS DATOS DEL INVENTARIO DE PANES?\n\nEsta acci√≥n no se puede deshacer.")) {
                localStorage.removeItem(STORAGE_KEY_DATA);
                localStorage.removeItem(STORAGE_KEY_RESP1);
                localStorage.removeItem(STORAGE_KEY_RESP2);
                location.reload();
            }
        }

        function renderInventoryTable() {
            const tbody = document.getElementById('inventory-list');
            tbody.innerHTML = ''; 

            inventoryData.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = 'table-row';
                tr.innerHTML = `
                    <td class="table-data product-cell">${item.name}</td>
                    <td class="table-data qty-cell" 
                        onclick="openCalculator(${index}, '${item.name.replace(/'/g, "\\'")}')"
                        id="qty-cell-${index}">
                        <span id="qty-display-${index}" data-quantity="${item.quantity}" data-history="${item.history || '0'}">${item.quantity}</span>
                    </td>
                `;
                tbody.appendChild(tr);
                
                if(item.quantity > 0) {
                    setTimeout(() => { 
                        const cell = document.getElementById(`qty-cell-${index}`);
                        if(cell) {
                            cell.style.color = document.body.classList.contains('light-theme') ? '#059669' : '#a3e635';
                        }
                    }, 0);
                }
            });
        }

        // --- L√ìGICA DE CALCULADORA ---
        const calculator = {
            displayValue: '0',
            firstOperand: null,
            waitingForSecondOperand: false,
            operator: null,
            currentProductIndex: null,
            fullExpression: '0',
            isResultCalculated: false,
        };

        function openCalculator(index, productName) {
            calculator.currentProductIndex = index;
            document.getElementById('calc-product-name').innerText = productName;
            
            const currentQty = inventoryData[index].quantity;
            const currentHist = inventoryData[index].history || '0';
            
            clearCalculator(false); 
            
            calculator.displayValue = String(currentQty);
            calculator.fullExpression = currentHist;
            calculator.firstOperand = parseFloat(currentQty);
            calculator.isResultCalculated = true; 

            updateDisplay();
            document.getElementById('calculator-modal').style.display = 'flex';
        }

        function closeCalculator() {
            document.getElementById('calculator-modal').style.display = 'none';
            calculator.currentProductIndex = null;
        }

        function updateDisplay() {
            const display = document.getElementById('calc-display');
            const history = document.getElementById('calc-history');
            
            display.textContent = calculator.displayValue;
            history.textContent = calculator.fullExpression;

            if(calculator.displayValue.length > 9) {
                display.style.fontSize = '1.5rem';
            } else {
                display.style.fontSize = '2.25rem';
            }
        }

        function inputDigit(digit) {
            const { displayValue, waitingForSecondOperand, isResultCalculated } = calculator;

            if (isResultCalculated) {
                calculator.displayValue = digit;
                calculator.fullExpression = digit; 
                calculator.isResultCalculated = false;
                calculator.firstOperand = null;
            } else if (waitingForSecondOperand) {
                calculator.displayValue = digit;
                calculator.waitingForSecondOperand = false;
                calculator.fullExpression += digit;
            } else {
                calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
                if(calculator.fullExpression === '0' && digit !== '.') calculator.fullExpression = '';
                calculator.fullExpression += digit;
            }
            updateDisplay();
        }

        function handleOperator(nextOperator) {
            const { firstOperand, displayValue, operator } = calculator;
            const inputValue = parseFloat(displayValue);

            if (operator && calculator.waitingForSecondOperand) {
                calculator.operator = nextOperator;
                calculator.fullExpression = calculator.fullExpression.slice(0, -1) + nextOperator;
                updateDisplay();
                return;
            }

            if (firstOperand == null && !isNaN(inputValue)) {
                calculator.firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation(firstOperand, inputValue, operator);
                calculator.displayValue = String(result);
                calculator.firstOperand = result;
            }

            calculator.waitingForSecondOperand = true;
            calculator.operator = nextOperator;
            calculator.isResultCalculated = false; 

            if(nextOperator !== '=') {
                 calculator.fullExpression += nextOperator;
            }
            updateDisplay();
        }

        function performCalculation(first, second, op) {
            if (op === '+') return first + second;
            if (op === '-') return first - second;
            if (op === '*') return first * second;
            if (op === '/') return second !== 0 ? first / second : 0; 
            return second;
        }

        function clearCalculator(resetUI = true) {
            calculator.displayValue = '0';
            calculator.firstOperand = null;
            calculator.waitingForSecondOperand = false;
            calculator.operator = null;
            calculator.fullExpression = '0';
            calculator.isResultCalculated = false;
            if(resetUI) updateDisplay();
        }

        function backspaceCalculator() {
            if(calculator.isResultCalculated) { clearCalculator(); return; }
            
            let val = calculator.displayValue;
            calculator.displayValue = val.length > 1 ? val.slice(0, -1) : '0';
            
            let expr = calculator.fullExpression;
            calculator.fullExpression = expr.length > 1 ? expr.slice(0, -1) : '0';
            
            updateDisplay();
        }

        function saveAndClose() {
            if(calculator.currentProductIndex === null) return;

            if(calculator.operator && !calculator.waitingForSecondOperand) {
                handleOperator('=');
            }
            
            let finalVal = parseFloat(calculator.displayValue);
            if(isNaN(finalVal) || finalVal < 0) finalVal = 0;
            finalVal = Math.floor(finalVal); 

            inventoryData[calculator.currentProductIndex].quantity = finalVal;
            inventoryData[calculator.currentProductIndex].history = calculator.fullExpression; 
            
            saveDataToLocal(); // GUARDAR 

            const displayEl = document.getElementById(`qty-display-${calculator.currentProductIndex}`);
            displayEl.textContent = finalVal;
            displayEl.setAttribute('data-quantity', finalVal);
            
            const cell = document.getElementById(`qty-cell-${calculator.currentProductIndex}`);
            if(finalVal > 0) {
                cell.style.color = '#a3e635'; 
                if(document.body.classList.contains('light-theme')) cell.style.color = '#059669'; 
            } else {
                cell.style.color = ''; 
            }

            calculateTotalItems();
            closeCalculator();
        }

        function calculateTotalItems() {
            const count = inventoryData.filter(i => i.quantity > 0).length;
            document.getElementById('stocked-products-count').textContent = count;
        }

        // --- EXPORTAR EXCEL (CSV) ---
        function downloadExcel() {
            const resp1 = document.getElementById('responsable-1').value || "Sin Nombre";
            const resp2 = document.getElementById('responsable-2').value || "Sin Nombre";
            const fecha = document.getElementById('report-date').textContent;
            
            // Calcular Total General
            const totalGeneral = inventoryData.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);

            let csvContent = "\uFEFF"; 
            
            // Cabecera Reporte
            csvContent += `REPORTE DE INVENTARIO - PASILLO PANES\n`;
            csvContent += `ORGANISMO: CECOSESOLA R.L.\n`;
            csvContent += `FECHA:;${fecha}\n`;
            csvContent += `RESPONSABLE 1:;${resp1}\n`;
            csvContent += `RESPONSABLE 2:;${resp2}\n\n`;

            // Columnas: ORDEN CAMBIADO A PRODUCTO, HISTORIAL, CANTIDAD
            csvContent += "PRODUCTO;HISTORIAL (OPERACIONES);CANTIDAD\n";

            inventoryData.forEach(row => {
                // Datos en el nuevo orden
                csvContent += `${row.name};${row.history};${row.quantity}\n`;
            });
            
            // Fila de Total General al final (ajustada a la columna 3)
            csvContent += `\nTOTAL GENERAL;;${totalGeneral}\n`;

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            
            const cleanDate = fecha.replace(/\//g, '-');
            
            link.setAttribute("href", url);
            link.setAttribute("download", `Inventario_Panes_${cleanDate}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- UTILIDADES UI ---
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            document.getElementById('moon-icon').classList.toggle('hidden', isLight);
            document.getElementById('sun-icon').classList.toggle('hidden', !isLight);
            
            renderInventoryTable(); 
            inventoryData.forEach((item, idx) => {
                const el = document.getElementById(`qty-display-${idx}`);
                if(el) el.textContent = item.quantity;
                if(item.quantity > 0) {
                     const cell = document.getElementById(`qty-cell-${idx}`);
                     cell.style.color = isLight ? '#059669' : '#a3e635';
                }
            });
        }

        function updateReportHeaders() {
            const r1 = document.getElementById('responsable-1').value;
            const r2 = document.getElementById('responsable-2').value;
            document.getElementById('resp1-display').textContent = r1 || "SIN NOMBRE";
            document.getElementById('resp2-display').textContent = r2 || "SIN NOMBRE";
            
            saveDataToLocal(); // GUARDAR 
        }
    </script>
</body>
</html>
